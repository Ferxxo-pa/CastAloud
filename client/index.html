<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />
    <title>Cast Aloud - Voice Accessibility for Farcaster</title>
    <meta name="description" content="Accessibility tools for reading and replying to Farcaster casts using voice technology. Listen to casts aloud and reply using your voice." />
    
    <!-- Open Graph / Farcaster Meta Tags -->
    <meta property="og:title" content="Cast Aloud - Voice Accessibility for Farcaster" />
    <meta property="og:description" content="Accessibility tools for reading and replying to Farcaster casts using voice technology" />
    <meta property="og:image" content="https://castaloud.replit.app/og-image.png" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://castaloud.replit.app" />
    
    <!-- Farcaster Mini App Configuration -->
    <meta name="fc:frame" content="vNext" />
    <meta name="fc:frame:image" content="https://castaloud.replit.app/og-image.png" />
    <meta name="fc:frame:button:1" content="Open Mini App" />
    <meta name="fc:frame:button:1:action" content="link" />
    <meta name="fc:frame:button:1:target" content="https://castaloud.replit.app" />
    <meta name="fc:frame:post_url" content="https://castaloud.replit.app/api/frame" />
    <meta name="of:version" content="vNext" />
    <meta name="of:accepts:farcaster" content="vNext" />
    <meta name="of:image" content="https://castaloud.replit.app/og-image.png" />
    <meta name="of:input:text" content="Enter text to convert to speech" />
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="/favicon.png" />
    
    <!-- Mini App manifest -->
    <link rel="manifest" href="/manifest.json" />
    
    <!-- Farcaster Mini App manifest link -->
    <link rel="farcaster-manifest" href="/farcaster-manifest.json" />
    
    <!-- Service Worker for Mini App - Temporarily disabled for debugging -->
    <!--
    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('/sw.js')
            .then(registration => console.log('SW registered:', registration))
            .catch(error => console.log('SW registration failed:', error));
        });
      }
    </script>
    -->
    
    <!-- Theme -->
    <meta name="theme-color" content="#FFFFFF" />
    <meta name="msapplication-navbutton-color" content="#FFFFFF">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
  </head>
  <body style="background-color: white; margin: 0; padding: 0;">
    <!-- Static fallback content that should always show -->
    <div style="padding: 20px; font-family: Arial, sans-serif; background: white;">
      <h1 style="color: #8A63D2; margin: 0 0 20px 0;">Cast Aloud</h1>
      <p style="color: #666; margin: 0 0 20px 0;">Voice accessibility tools for reading and replying to Farcaster casts</p>
      
      <div style="background: #f0f0f0; padding: 15px; border-radius: 8px; margin: 20px 0;">
        <h2 style="margin: 0 0 10px 0; color: #333;">App Status</h2>
        <div id="status">Loading...</div>
      </div>
      
      <div style="background: #e8f4f8; padding: 15px; border-radius: 8px; margin: 20px 0;">
        <h3 style="margin: 0 0 10px 0;">Quick Test</h3>
        <button onclick="testBasicFunction()" style="background: #8A63D2; color: white; border: none; padding: 10px 20px; border-radius: 4px; cursor: pointer;">
          Test JavaScript
        </button>
        <div id="test-result" style="margin-top: 10px;"></div>
      </div>
    </div>
    
    <!-- Completely bypass React and serve working HTML/CSS/JS directly -->
    <div id="cast-aloud-app">
      <style>
        * { box-sizing: border-box; }
        body { margin: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
        .fc-gray-50 { background-color: #fafafa; }
        .fc-gray-900 { color: #242424; }
        .fc-gray-600 { color: #6b6b6b; }
        .fc-gray-200 { background-color: #e8e8e8; }
        .fc-gray-300 { background-color: #d1d1d1; }
        .fc-gray-800 { color: #383838; }
        .fc-purple { background-color: #8A63D2; }
        .fc-purple-dark { background-color: #7652C4; }
        .fc-error { color: #ef4444; }
        
        .container { max-width: 500px; margin: 0 auto; padding: 20px; min-height: 100vh; background: #fafafa; }
        .header { text-align: center; margin-bottom: 30px; }
        .app-title { color: #8A63D2; font-size: 32px; font-weight: bold; margin: 0; }
        .app-subtitle { color: #6b6b6b; margin: 10px 0 0 0; }
        .card { background: white; border-radius: 12px; padding: 24px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); position: relative; border: 1px solid #e8e8e8; }
        .btn { background: #8A63D2; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-size: 16px; width: 100%; margin: 8px 0; }
        .btn:hover { background: #7652C4; }
        .btn-secondary { background: #e8e8e8; color: #383838; }
        .btn-secondary:hover { background: #d1d1d1; }
        .read-aloud-btn { position: absolute; top: 16px; right: 16px; width: auto; padding: 8px 16px; font-size: 14px; display: flex; align-items: center; gap: 8px; }
        .voice-settings { background: #f8f9fa; border-radius: 8px; padding: 16px; margin-top: 16px; display: none; }
        .form-group { margin: 12px 0; }
        .form-group label { display: block; margin-bottom: 4px; font-weight: 500; }
        .form-group select, .form-group input { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; }
        .how-it-works { background: #f0f7ff; border-radius: 8px; padding: 16px; margin-top: 16px; }
        .speaking { background: rgba(239, 68, 68, 0.1); color: #ef4444; }
        .not-speaking { background: rgba(138, 99, 210, 0.1); color: #8A63D2; }
      </style>
      
      <div class="container">
        <div class="header">
          <h1 class="app-title">Cast Aloud</h1>
          <p class="app-subtitle">Accessibility tools for reading and replying to casts</p>
        </div>
        
        <div class="card">
          <button id="readAloudBtn" class="btn read-aloud-btn not-speaking" onclick="toggleReading()">
            <span id="readIcon">üîä</span>
            <span id="readText">Read Aloud</span>
          </button>
          
          <h2 style="margin-top: 0; font-size: 20px; color: #242424;">Try the Mini App</h2>
          <p style="color: #6b6b6b; margin-bottom: 20px;">
            The mini app helps you read casts aloud and create voice replies with AI assistance.
          </p>
          
          <div style="display: flex; flex-direction: column; gap: 12px;">
            <button class="btn" onclick="readSampleCast()">
              Read Cast Aloud
            </button>
            
            <button class="btn btn-secondary" onclick="toggleVoiceSettings()">
              Voice Settings
            </button>
          </div>

          <div id="voiceSettings" class="voice-settings">
            <h3 style="margin-top: 0;">Voice Settings</h3>
            
            <div class="form-group">
              <label>Voice:</label>
              <select id="voiceSelect">
                <option value="">Loading voices...</option>
              </select>
            </div>
            
            <div class="form-group">
              <label>Speed: <span id="speedValue">1.0x</span></label>
              <input type="range" id="speedSlider" min="0.5" max="2" step="0.1" value="1.0">
            </div>
            
            <button class="btn btn-secondary" onclick="testVoice()">
              Test Voice
            </button>
          </div>
          
          <div class="how-it-works">
            <h3 style="margin-top: 0;">How it works:</h3>
            <ol style="margin: 0; padding-left: 20px;">
              <li>üìù Paste a Farcaster post URL or text directly</li>
              <li>üîä Click "Read Aloud" to hear the content</li>
              <li>‚úçÔ∏è Type your reply in the text area</li>
              <li>ü§ñ Get AI feedback or polish your reply</li>
              <li>üìã Copy the improved reply to post on Farcaster</li>
            </ol>
          </div>
        </div>
      </div>
    </div>

    <script>
      // Cast Aloud functionality
      let voices = [];
      let selectedVoice = null;
      let speechRate = 1.0;
      let isSpeaking = false;
      let showingSettings = false;
      
      function loadVoices() {
        voices = speechSynthesis.getVoices();
        const voiceSelect = document.getElementById('voiceSelect');
        voiceSelect.innerHTML = '<option value="">Select a voice...</option>';
        
        voices.forEach((voice, index) => {
          const option = document.createElement('option');
          option.value = index;
          option.textContent = voice.name + ' (' + voice.lang + ')';
          voiceSelect.appendChild(option);
        });
        
        if (voices.length > 0) {
          selectedVoice = voices[0];
          voiceSelect.value = 0;
        }
      }
      
      speechSynthesis.addEventListener('voiceschanged', loadVoices);
      loadVoices();
      
      document.getElementById('voiceSelect').addEventListener('change', function(e) {
        if (e.target.value !== '') {
          selectedVoice = voices[parseInt(e.target.value)];
        }
      });
      
      document.getElementById('speedSlider').addEventListener('input', function(e) {
        speechRate = parseFloat(e.target.value);
        document.getElementById('speedValue').textContent = speechRate.toFixed(1) + 'x';
      });
      
      function toggleVoiceSettings() {
        const settings = document.getElementById('voiceSettings');
        showingSettings = !showingSettings;
        settings.style.display = showingSettings ? 'block' : 'none';
      }
      
      function toggleReading() {
        const pageText = 'Cast Aloud. Accessibility tools for reading and replying to casts. Try the Mini App. The mini app helps you read casts aloud and create voice replies with AI assistance. How it works: 1. Paste a Farcaster post URL or text directly. 2. Click Read Aloud to hear the content. 3. Type your reply in the text area. 4. Get AI feedback or polish your reply. 5. Copy the improved reply to post on Farcaster.';
        
        if (isSpeaking) {
          speechSynthesis.cancel();
          updateReadButton(false);
        } else {
          speak(pageText);
        }
      }
      
      function readSampleCast() {
        const sampleText = 'Hello from Cast Aloud! This is a sample Farcaster cast being read aloud using voice technology. Cast Aloud helps make social media more accessible by providing voice features for reading and replying to posts. You can adjust the voice settings to customize your listening experience.';
        speak(sampleText);
      }
      
      function testVoice() {
        const testText = "This is a test of your voice settings. How does this sound?";
        speak(testText);
      }
      
      function speak(text) {
        if (isSpeaking) {
          speechSynthesis.cancel();
          updateReadButton(false);
          return;
        }
        
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.rate = speechRate;
        if (selectedVoice) {
          utterance.voice = selectedVoice;
        }
        
        utterance.onstart = function() {
          isSpeaking = true;
          updateReadButton(true);
        };
        
        utterance.onend = function() {
          isSpeaking = false;
          updateReadButton(false);
        };
        
        utterance.onerror = function() {
          isSpeaking = false;
          updateReadButton(false);
        };
        
        speechSynthesis.speak(utterance);
      }
      
      function updateReadButton(speaking) {
        const btn = document.getElementById('readAloudBtn');
        const icon = document.getElementById('readIcon');
        const text = document.getElementById('readText');
        
        if (speaking) {
          btn.className = 'btn read-aloud-btn speaking';
          icon.textContent = '‚èπÔ∏è';
          text.textContent = 'Stop';
        } else {
          btn.className = 'btn read-aloud-btn not-speaking';
          icon.textContent = 'üîä';
          text.textContent = 'Read Aloud';
        }
      }
      
      console.log('Cast Aloud loaded successfully');
    </script>
    <!-- Replit banner disabled to prevent yellow screen flash -->
    <!-- <script type="text/javascript" src="https://replit.com/public/js/replit-dev-banner.js"></script> -->
  </body>
</html>